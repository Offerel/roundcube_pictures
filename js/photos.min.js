function initGallery(){let e=parseInt(document.getElementById("scount").dataset.margin);$("#folders").justifiedGallery({rowHeight:220,maxRowHeight:220,margins:e,border:0,rel:"folders",lastRow:"nojustify",captions:!1,randomize:!1}),$(".fimages").justifiedGallery({rowHeight:190,maxRowHeight:220,margins:e,border:0,rel:"gallery",lastRow:"nojustify",captions:!1,randomize:!1})}function markDay(){for(let e of document.querySelectorAll(".marker, .dhfmt"))e.addEventListener("click",t=>{let n=e.parentNode.dataset.day;if(1==e.dataset.cb){for(let e of document.querySelectorAll('[data-dday="'+n+'"]'))e.checked=!1;e.dataset.cb=0}else{for(let e of document.querySelectorAll('[data-dday="'+n+'"]'))e.checked=!0;e.dataset.cb=1}count_checks()})}function count_checks(){let e=document.querySelectorAll(".icheckbox:checked").length;e>0?(scount.innerText=scount.dataset.text.replace("%count%",e),scount.style.display="inline",window.parent.document.getElementById("movepicture").classList.remove("disabled"),window.parent.document.getElementById("delpicture").classList.remove("disabled"),window.parent.document.getElementById("sharepicture").classList.remove("disabled"),window.parent.document.getElementById("editmeta").classList.remove("disabled")):(scount.innerText="",scount.style.display="none",window.parent.document.getElementById("movepicture").classList.add("disabled"),window.parent.document.getElementById("delpicture").classList.add("disabled"),window.parent.document.getElementById("sharepicture").classList.add("disabled"),window.parent.document.getElementById("editmeta").classList.add("disabled"))}function checkboxes(){let e=$(".icheckbox"),t=null;e.click(function(n){if(t){if(n.shiftKey){let n=e.index(this),o=e.index(t);e.slice(Math.min(n,o),Math.max(n,o)+1).prop("checked",t.checked)}t=this}else t=this})}function iBoxShow(e){let t=document.getElementById(document.getElementById("infbtn").dataset.iid),n=t.cloneNode(!0);n.id="infobox",n.classList.add("eshow"),document.getElementById("infobox")?(document.getElementById("infobox").remove(),null==e&&document.querySelector(".gcontainer").append(n)):document.querySelector(".gcontainer").append(n)}function stop_loop(){if(document.getElementById("pbtn")){let e=document.getElementById("pbtn");e.classList.remove("on"),e.addEventListener("click",loop_slide.bind(this,5))}clearInterval(intervalID),document.getElementById("slide_progress").style.width=0}function loop_slide(e=3){function t(){n>=100?(clearInterval(intervalID),loop_slide(e)):(n+=100/(60*e),document.getElementById("slide_progress").style.width=n+"vw")}document.getElementById("pbtn").classList.add("on"),lightbox.nextSlide();var n=1;intervalID=setInterval(t,10)}function aLoader(e="visible"){document.getElementById("loader").style.visibility=e}function handleDragOver(e){e.preventDefault(),"body"!=this.localName&&this.classList.add("mmn-drop")}function handleDragLeave(e){e.preventDefault(),this.classList.remove("mmn-drop")}function handleDrop(e){e.stopPropagation(),e.preventDefault(),this.classList.remove("mmn-drop");let t=this.parentElement.href?this.parentElement.href:location.href,n=new URL(t).searchParams.get("p");startUpload(e.dataTransfer.files,n)}function startUpload(e,t){let n=new FormData;xhr=new XMLHttpRequest;let o=$maxfiles,l=["image/jpeg","video/mp4"];t=decodeURIComponent((t+"").replace(/\+/g,"%20"));let i=document.getElementById("progress");if(e.length>o)return console.log("You try to upload more than the max count of allowed files("+o+")"),!1;for(var d=0;d<e.length;d++){if(-1==l.indexOf(e.item(d).type))return console.log("Unsupported filetype("+e.item(d).name+"), exiting"),!1;n.append("galleryfiles[]",e.item(d),e.item(d).name),n.append("folder",t)}xhr.upload.addEventListener("progress",function(e){let t=Math.ceil(e.loaded/e.total*100);i.style.visibility="visible",i.firstChild.innerHTML=t+"%",i.firstChild.style.width=t+"%"}),xhr.onload=function(){if(200===xhr.status){let t=JSON.parse(xhr.responseText),n="";for(var e=0;e<t.length;e++){switch(t[e].type){case"error":n="#dc3545";break;case"warning":n="#ffc107";break;default:n="#28a745"}i.firstChild.style.backgroundColor=n,console.log(t[e].message)}setTimeout(function(){i.style.visibility="hidden",i.firstChild.style.width=0,i.firstChild.style.backgroundColor="#007bff",location.reload(),count_checks()},5e3)}},xhr.open("POST","photos.php"),xhr.send(n)}function lazyload(e=!1){if(document.getElementById("last")&&!e)return!1;if(document.getElementsByClassName("glightbox").length<=0&&!e)return!1;let t=$(document).height()-10,n=Math.ceil($(window).scrollTop()+$(window).height()),o=document.getElementById("timeline")?"timeline":scount.dataset.title;if(n>t||e){let e=document.querySelectorAll(".icheckbox"),t="timeline"===o?parseInt(e[e.length-1].dataset.os)+1:$(".glightbox").length;$.ajax({type:"POST",url:"photos.php",async:!1,beforeSend:aLoader("visible"),data:JSON.stringify({action:"lazyload",g:o,s:t}),contentType:"application/json; charset=utf-8",success:function(e){return aLoader("hidden"),"timeline"==o?($("#timeline").append(e),initGallery(),markDay()):($(".fimages").append(e),$(".fimages").justifiedGallery("norewind")),!1}})}}var intervalID;window.onload=function(){let e=document.getElementById("scount"),t=e.dataset.prd,n=e.dataset.title.split("/"),o=n.length>0&&""!=n[0]?t+" - "+n[n.length-1]:t;window.parent.document.title=o,"complete"!==document.readyState&&aLoader("hidden"),initGallery(),$(".fimages").justifiedGallery().on("jg.complete",function(e){for(e of(e.currentTarget.clientHeight>100&&e.currentTarget.clientHeight<document.documentElement.clientWidth&&e.currentTarget.classList.contains("alb")&&lazyload(),document.getElementsByClassName("icheckbox")))e.addEventListener("change",count_checks)}),$(window).scroll(function(){lazyload()});const l=GLightbox({plyr:{config:{muted:!0}},autoplayVideos:!1,loop:!1,videosWidth:"100%",closeOnOutsideClick:!1,closeButton:!0});l.on("slide_changed",e=>{}),l.on("slide_before_change",e=>{}),l.on("close",()=>{}),l.on("open",()=>{}),Array.from(document.getElementsByClassName("folder")).forEach(function(e,t,n){e.addEventListener("click",function(){aLoader()})}),checkboxes(),markDay();let i=window.scrollY,d=document.getElementById("header");if(d){let e=document.querySelector("#header .breadcrumb");e.lastElementChild.previousElementSibling.addEventListener("click",function(t){e.childElementCount>2&&(t.preventDefault(),window.parent.edit_album())}),document.getElementById("aadd").addEventListener("click",e=>{parent.add_album()}),window.onscroll=function(){var e=window.scrollY;i>e?(d.style.top="0",e>150?d.classList.add("shadow"):d.classList.remove("shadow")):(d.style.top="-55px",d.classList.remove("shadow")),i=e}}e.addEventListener("click",e=>{parent.rm_checks()});for(var a=document.getElementsByClassName("dropzone"),s=0;s<a.length;s++)a[s].addEventListener("dragover",handleDragOver,!1),a[s].addEventListener("dragleave",handleDragLeave,!1),a[s].addEventListener("drop",handleDrop,!1)};