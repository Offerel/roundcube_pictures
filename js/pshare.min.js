function lazyload(e=!1){$.ajax({type:"POST",url:window.location.href,async:!1,data:{s:$(".glightbox").length},success:function(e){$("#images").append(e),$("#images").justifiedGallery("norewind");const t=(new DOMParser).parseFromString(e,"text/html");return t.body.childNodes.forEach(e=>{e.classList&&e.classList.contains("glightbox")&&lightbox.insertSlide({href:e.href,type:e.dataset.type})}),lightbox.reload(),e}})}function stop_loop(){if(document.getElementById("pbtn")){let e=document.getElementById("pbtn");e.classList.remove("on"),e.addEventListener("click",loop_slide.bind(this,5))}clearInterval(intervalID),document.getElementById("slide_progress").style.width=0}function loop_slide(e=3){function t(){n>=100?(clearInterval(intervalID),loop_slide(e)):(n+=100/(60*e),document.getElementById("slide_progress").style.width=n+"vw")}document.getElementById("pbtn")&&document.getElementById("pbtn").classList.add("on"),lightbox.nextSlide();var n=1;intervalID=setInterval(t,10)}function iBoxShow(e){if(!document.getElementById("infbtn"))return document.getElementById("infobox").classList.remove("eshow"),!1;let t=document.getElementById(document.getElementById("infbtn").dataset.iid),n=t.cloneNode(!0);n.id="infobox",n.classList.add("eshow"),document.getElementById("infobox")?(document.getElementById("infobox").remove(),null==e&&document.querySelector(".gcontainer").append(n)):document.querySelector(".gcontainer").append(n)}var intervalID;window.onload=function(){if($("#images").length){$("#images").justifiedGallery({rowHeight:220,margins:7,border:0,lastRow:"nojustify",captions:!1,randomize:!1,selector:".glightbox"}),$("#images").justifiedGallery().on("jg.complete",function(e){e.currentTarget.clientHeight>100&&e.currentTarget.clientHeight<document.documentElement.clientWidth&&lazyload()});let n=new IntersectionObserver(function(e){let t=!document.getElementById("last");e[0].isIntersecting&&e[0].time>700&&t&&lazyload(!0)},{threshold:[0]});n.observe(document.querySelector("#btm")),lightbox=GLightbox({plyr:{config:{iconUrl:"plugins/pictures/js/plyr/plyr.svg",muted:!0}},autoplayVideos:!1,loop:!1,videosWidth:"100%",closeOnOutsideClick:!1}),lightbox.on("close",()=>{stop_loop(),document.getElementById("infbtn")&&document.getElementById("infbtn").remove(),document.querySelectorAll(".exinfo").forEach(e=>{e.classList.remove("eshow")})}),lightbox.on("slide_changed",e=>{let t=e.current.index+1,n=lightbox.elements.length,o=new URL(e.current.slideConfig.href),l="exif_"+o.searchParams.get("p"),i=document.querySelector(".gclose"),d=!!document.getElementById("pbtn")&&document.getElementById("pbtn").classList.contains("on");document.getElementById("btn_container")&&document.getElementById("btn_container").remove();let s=document.createElement("div");s.id="btn_container";let c=document.querySelector(".gcontainer"),r=document.createElement("button");r.id="infbtn",r.dataset.iid=l,r.addEventListener("click",iBoxShow,!0);let a=document.createElement("button");a.id="dlbtn",a.addEventListener("click",t=>{window.location="plugins/pictures/simg.php?w=4&i="+new URL(e.current.slideConfig.href).searchParams.get("p")});let m=document.createElement("button");m.id="fbtn",m.addEventListener("click",e=>{document.fullscreenElement?document.exitFullscreen():document.getElementById("glightbox-body").requestFullscreen(),m.classList.toggle("on")});let u=document.createElement("button");u.id="pbtn",d?(u.classList.add("on"),u.addEventListener("click",stop_loop)):u.addEventListener("click",loop_slide.bind(this,5)),s.appendChild(u),document.getElementById("images").classList.contains("dl")&&"video"!=e.current.slideConfig.type&&s.appendChild(a),document.getElementById(l)&&s.appendChild(r),s.appendChild(m),s.appendChild(i),c.appendChild(s),document.getElementById("infobox")&&iBoxShow(),document.getElementById("last")&&t===n&&stop_loop()}),lightbox.on("slide_before_change",e=>{let t=e.current.index+1,n=lightbox.elements.length,o=!document.getElementById("last");t==n&&o&&setTimeout(lazyload,100,!0)});var e=window.scrollY,t=document.getElementById("header");window.onscroll=function(){var n=window.scrollY;e>n?(t.style.top="0",n>150?t.classList.add("shadow"):t.classList.remove("shadow")):(t.style.top="-55px",t.classList.remove("shadow")),e=n}}top.location!=self.location&&(top.location=self.location.href),window.addEventListener("contextmenu",function(e){return e.preventDefault(),e.stopPropagation(),!1})};