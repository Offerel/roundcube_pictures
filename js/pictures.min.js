function pixelfed_verify(e){200==e.code&&null!=this.response.base_url?document.getElementById("sbtn").classList.remove("disabled"):(document.getElementById("pstatus").disabled=!0,document.getElementById("pfvisibility").disabled=!0,document.getElementById("pfsensitive").disabled=!0,document.getElementById("sbtn").classList.add("disabled"),rcmail.display_message('Configuration error. Please check Pixelfed configuration in "Pictures" settings',"error"))}function validateUser(e){let t=document.getElementById("shares"),n=document.getElementById("rsh"),l=document.getElementById("expiredate"),d=document.getElementById("sbtn"),i=document.getElementById("never"),o=document.getElementById("suser");200===e.code?(t.disabled=!0,n.disabled=!0,l.disabled=!0,l.style.color="lightgray",i.disabled=!0,o.style.color="green",o.style.borderColor="green",o.style.backgroundColor="honeydew",d.title=rcmail.gettext("intsharetitle","pictures"),document.getElementById("uid").value=e):(t.disabled=!1,n.disabled=!1,l.disabled=!1,l.style.color="black",i.disabled=!1,o.style.color="orangered",o.style.borderColor="red",o.style.backgroundColor="antiquewhite",d.title=rcmail.gettext("extlinktitle","pictures"),document.getElementById("uid").value="")}function shareDel(e){if(200===e.code){sendRequest(getshares),document.getElementById("sid").value="",document.getElementById("sname").value="",document.getElementById("expiredate").value="",document.getElementById("expiredate").disabled=!1,document.getElementById("rsh").disabled=!0,document.getElementById("never").checked=!1,document.getElementById("link").value="";let e=new Date;document.getElementById("expiredate").valueAsDate=new Date(e.setDate(e.getDate()+rcmail.env.sdays))}return!1}function iBoxShow(e){if(!document.getElementById("infbtn"))return document.getElementById("infobox").classList.remove("eshow"),!1;let t=document.getElementById(document.getElementById("infbtn").dataset.iid),n=t.cloneNode(!0);n.id="infobox",n.classList.add("eshow"),document.getElementById("infobox")?(document.getElementById("infobox").remove(),null==e&&document.querySelector(".gcontainer").append(n)):document.querySelector(".gcontainer").append(n)}function dosearch(){let e=document.getElementById("skeywords").value.split(" ").filter(e=>e);if(e.length<=0)return document.getElementById("searchphotof").style.display="none",!1;sendRequest(search,e)}function search(e){document.getElementById("searchphotof").style.display="none",setTimeout(()=>{if(e.images.length>0){let t=document.getElementById("picturescontentframe"),n=t.contentWindow.document.getElementById("images"),l=t.contentWindow.document.getElementById("folders"),d=document.createElement("span");d.id="last",n.replaceChildren(d),e.images.forEach(e=>{let t=document.createElement("div"),l=document.createElement("a");l.setAttribute("class","image glightbox"),l.href="simg.php?file="+e.path;let d=document.createElement("img");d.src="simg.php?file="+e.path+"&t=1",d.width=e.dim[0],d.height=e.dim[1],d.setAttribute("alt",e.alt),l.appendChild(d),t.appendChild(l);let i=document.createElement("input");i.name="images",i.value="file",i.type="checkbox",i.addEventListener("change",count_checks),i.classname="icheckbox",t.appendChild(i);let o=document.createElement("div");o.id=e.path.split("/").pop(),o.setAttribute("class","exinfo");let a="";for(let t in e.exif)a+="map"!==t?t+": "+e.exif[t]+"<br>":'<img src="images/marker.png"><a class="mapl" href="'+e.exif[t].osm+'" target="_blank">OSM</a> | <a class="mapl" href="'+e.exif[t].google+'" target="_blank">Google Maps</a>';o.innerHTML=a,t.appendChild(o),n.appendChild(t)}),l.style.display="none";let i=t.contentWindow.document.querySelector("#header .breadcrumb");i.innerHTML="<li>"+rcmail.gettext("searchfor","pictures")+e.keywords.join(", ")+"</li>",t.contentWindow.lightbox.reload(),t.contentWindow.$("#images").justifiedGallery("norewind")}else rcmail.display_message(rcmail.gettext("noresults","pictures"),"error")},50)}function searchform(){$("#searchphotof").contents().find("h2").html(rcmail.gettext("search","pictures")),document.getElementById("searchphotof").style.display="block",document.getElementById("skeywords").focus()}function metaform(){let e=document.getElementById("picturescontentframe"),t=e.contentWindow.document.querySelectorAll('input[type="checkbox"]:checked'),n=[];for(let e=0;e<t.length;e++){let l=new URLSearchParams(new URL(t[e].baseURI).search).get("p");n.push(l+"/"+t[e].value)}sendRequest(getMetadata,{media:n})}function getMetadata(e){2==e.mdata.keywords?(tagify.DOM.input.setAttribute("data-placeholder","Multiple Values"),document.getElementById("mekeywords").value=""):document.getElementById("mekeywords").value=e.mdata.keywords,2==e.mdata.title?(document.getElementById("metitle").placeholder="Multiple Values",document.getElementById("metitle").value=""):document.getElementById("metitle").value=e.mdata.title,2==e.mdata.description?(document.getElementById("medescription").placeholder="Multiple Values",document.getElementById("medescription").value=""):document.getElementById("medescription").value=e.mdata.description,document.getElementById("mdheader").innerText=rcmail.gettext("metadata","pictures"),document.getElementById("metadata").style.display="block",document.getElementById("mekeywords").focus()}function save_meta(e){const t=document.getElementById("picturescontentframe"),n=t.contentWindow.document.querySelectorAll('input[type="checkbox"]:checked');dloader("#metadata",mes,"add");let l=[];for(let e=0;e<n.length;e++){let t=new URLSearchParams(new URL(n[e].baseURI).search).get("p");l.push(t+"/"+n[e].value)}const d={keywords:JSON.parse(document.getElementById("mekeywords").value).map(e=>e.value),title:document.getElementById("metitle").value,description:document.getElementById("medescription").value,files:l};let i=d.keywords.filter(t=>!e.includes(t));sendRequest(setKeywords,{keywords:i}),sendRequest(saveMetadata,d)}function saveMetadata(e){dloader("#metadata",mes,"remove"),document.getElementById("metadata").style.display="none",200===e.code?rcmail.display_message("Data saved","confirmation"):rcmail.display_message(e.message,"error")}function setKeywords(e){tagify.whitelist=e.keywords}function count_checks(){document.querySelectorAll('input[type="checkbox"]:checked').length>0?(window.parent.document.getElementById("movepicture").classList.remove("disabled"),window.parent.document.getElementById("delpicture").classList.remove("disabled"),window.parent.document.getElementById("sharepicture").classList.remove("disabled"),window.parent.document.getElementById("editmeta").classList.remove("disabled")):(window.parent.document.getElementById("movepicture").classList.add("disabled"),window.parent.document.getElementById("delpicture").classList.add("disabled"),window.parent.document.getElementById("sharepicture").classList.add("disabled"),window.parent.document.getElementById("editmeta").classList.add("disabled"))}function rm_checks(){let e=document.getElementById("picturescontentframe").contentWindow.document.querySelectorAll('input[type="checkbox"]:checked');for(let t=0;t<e.length;t++)e[t].checked&&(e[t].checked=!1);e=document.getElementById("picturescontentframe").contentWindow.document.querySelectorAll('input[type="checkbox"]:checked'),e.length<1&&(document.getElementById("sharepicture").classList.add("disabled"),document.getElementById("delpicture").classList.add("disabled"),document.getElementById("editmeta").classList.add("disabled"),document.getElementById("movepicture").classList.add("disabled"))}function lazyload(e=!1){$.ajax({type:"POST",url:window.location.href,async:!1,data:JSON.stringify({action:"lazyload",s:$(".glightbox").length}),contentType:"application/json; charset=utf-8",success:function(e){$("#images").append(e),$("#images").justifiedGallery("norewind");const t=(new DOMParser).parseFromString(e,"text/html");return t.body.childNodes.forEach(e=>{e.classList&&e.classList.contains("glightbox")&&lightbox.insertSlide({href:e.href,type:e.dataset.type})}),lightbox.reload(),e}})}function uploadpicture(){let e=document.createElement("input");const t=new URL(document.getElementById("picturescontentframe").contentWindow.location.href).searchParams.get("p");let n=document.getElementById("picturescontentframe").contentWindow.document.getElementById("progress");e.type="file",e.multiple="multiple",e.accept="image/webp, image/jpeg, image/png",e.id="ufrm",e.addEventListener("change",function(){xhr=new XMLHttpRequest;let l=new FormData;const d=e.files;for(let e=0;e<d.length;e++){const t=d[e];l.append("galleryfiles[]",t,t.name)}l.append("folder",t),xhr.upload.addEventListener("progress",function(e){let t=Math.ceil(e.loaded/e.total*100);n.style.visibility="visible",n.firstChild.innerHTML=t+"%",n.firstChild.style.width=t+"%"}),xhr.onload=function(){if(200===xhr.status){let l=JSON.parse(xhr.responseText),d="";for(var e=0;e<l.length;e++){switch(l[e].type){case"error":d="#dc3545";break;case"warning":d="#ffc107";break;default:d="#28a745"}n.firstChild.style.backgroundColor=d,console.log(l[e].message)}setTimeout(function(){n.style.visibility="hidden",n.firstChild.style.width=0,n.firstChild.style.backgroundColor="#007bff",document.getElementById("picturescontentframe").contentWindow.location.href="plugins/pictures/photos.php?p="+encodeURIComponent(t),count_checks()},5e3)}},xhr.open("POST","./plugins/pictures/photos.php"),xhr.send(l)});let l=document.getElementById("picturescontentframe").contentWindow.document.body;l.appendChild(e),e.click()}function selectShare(){let e=new URL(document.querySelector("iframe").contentWindow.document.documentURI),t=e.searchParams.get("p").split("/").pop();sendRequest(getshares),document.getElementById("sid").value="";let n=document.getElementById("sbtn");document.getElementById("sname").value=t,document.getElementById("expiredate").value="",document.getElementById("expiredate").disabled=!1,document.getElementById("rsh").disabled=!0,document.getElementById("never").checked=!1,document.getElementById("link").value="",document.getElementById("link").style.display="none",document.getElementById("pstatus").value="",document.getElementById("pfvisibility").selectedIndex=0,document.getElementById("pfsensitive").checked=!1,n.style.visibility="visible",$("#share_edit").contents().find("h2").html(rcmail.gettext("share","pictures")),document.getElementById("share_edit").style.display="block";let l=new Date;document.getElementById("expiredate").valueAsDate=new Date(l.setDate(l.getDate()+rcmail.env.sdays)),n.tabIndex=5,n.title=rcmail.gettext("extlinktitle","pictures"),document.getElementById("public").click()}function add_album(){var e=get_currentalbum();$("#album_edit").contents().find("h2").html(rcmail.gettext("new_album","pictures")),$("#album_org").val(e),$("#album_name").val(""),document.getElementById("mv_target").style.display="none",document.getElementById("albedit").style.display="none",document.getElementById("albadd").style.display="block",document.getElementById("album_edit").style.display="block",document.getElementById("album_name").focus()}function create_album(){sendRequest(albCreate,{target:document.getElementById("album_name").value,source:document.getElementById("album_org").value})}function albCreate(e){if(console.log(e),document.getElementById("album_edit").style.display="none",200===e.code){document.getElementById("picturescontentframe").contentWindow.location.href="plugins/pictures/photos.php?p="+encodeURIComponent(e.source),count_checks(),sendRequest(getSubs);let t=rcmail.gettext("alb_create_ok","pictures").replace("%t%",e.target);rcmail.display_message(t,"confirmation")}else{let t=rcmail.gettext("alb_create_failed","pictures").replace("%t%",e.target);rcmail.display_message(t,"error")}}function get_currentalbum(){var e=window.frames.picturescontentframe.location.search.substring(1).replace(/\+/g,"%20");if(""==e)return!1;for(e=e.split("#")[0],e=e.split("&");0<e.length;)return e=e[0].split("="),"p"==e[0]&&e[1]}function edit_album(){album=decodeURIComponent(get_currentalbum());var e=album.split("/");$("#album_edit").contents().find("h2").html("Album: "+e[e.length-1]),$("#album_name").val(e[e.length-1]),$("#album_org").val(album)-1!==document.getElementById("mv_target").innerHTML.indexOf("div")&&sendRequest(getSubs),document.getElementById("albedit").style.display="block",document.getElementById("albadd").style.display="none",document.getElementById("mv_target").style.display="block",document.getElementById("album_edit").style.display="block",document.getElementById("album_name").focus(),document.getElementById("dalb").removeEventListener("mouseover",btn_title),document.getElementById("mvb").removeEventListener("mouseover",btn_title),document.getElementById("rnb").removeEventListener("mouseover",btn_title),document.getElementById("dalb").addEventListener("mouseover",btn_title),document.getElementById("mvb").addEventListener("mouseover",btn_title),document.getElementById("rnb").addEventListener("mouseover",btn_title)}function btn_title(){let e="";switch(this.id){case"dalb":e=rcmail.gettext("DelAlbum","pictures")+" '"+document.getElementById("album_org").value.split("/").pop()+"'";break;case"mvb":e=rcmail.gettext("MovAlbum","pictures")+" '"+document.getElementById("album_org").value.split("/").pop()+"' "+rcmail.gettext("to","pictures")+" '"+document.getElementById("target").value+"/"+document.getElementById("album_org").value.split("/").pop()+"'";break;case"rnb":e=rcmail.gettext("RenAlbum","pictures")+" '"+document.getElementById("album_org").value.split("/").pop()+"' "+rcmail.gettext("to","pictures")+" '"+document.getElementById("album_org").value.split("/").pop()+"'"}this.title=e}function sendRequest(e,t={}){const n=JSON.stringify({action:e.name,data:t});xhr=new XMLHttpRequest,xhr.onload=function(){e(this.response)},xhr.open("POST","./plugins/pictures/photos.php"),xhr.setRequestHeader("Content-type","application/json; charset=utf-8"),xhr.responseType="json",xhr.send(n)}function getSubs(e){let t=document.createElement("select");t.id="target",e.dirs.forEach(e=>{let n=document.createElement("option");n.value=e,n.text=e,t.appendChild(n)}),t.selectedIndex=0,t.options[0].disabled=!0,document.getElementById("mv_target").firstChild.replaceWith(t),document.getElementById("mv_target_img").firstChild.replaceWith(t),setTimeout(document.getElementById("target").addEventListener("change",mvbtncl),1e3)}function mvbtncl(){document.getElementById("mvb").classList.remove("disabled"),document.getElementById("album_name").value=document.getElementById("album_org").value.split("/").pop(),document.getElementById("rnb").classList.add("disabled");let e=document.getElementById("mvp"),t=document.getElementById("album_name_img").value;t=t.length>0?t+"/":t,e.classList.remove("disabled"),e.title=rcmail.gettext("move","pictures")+" "+rcmail.gettext("to","pictures")+": '"+document.getElementById("target").selectedOptions[0].value+"/"+t+"'"}function getshares(e){let t=new URL(document.querySelector("iframe").contentWindow.document.documentURI),n=t.searchParams.get("p").split("/").pop();document.getElementById("suser").value="",document.getElementById("suser").style.borderColor="#b2b2b2",document.getElementById("sbtn").style.display="inline-block",document.getElementById("btnclp").style.display="none";let l=document.createElement("select");l.id="shares",l.tabIndex=-1,l.style.width="calc(100% - 20px)",e.shares.forEach(e=>{let t=document.createElement("option");t.value=e.id,t.dataset.ep=e.exp,t.dataset.dn=e.down,t.text=e.name,e.name===n&&(t.selected=!0,document.getElementById("sid").value=parseInt(e.id),document.getElementById("link").value="",e.exp?(document.getElementById("never").checked=!1,document.getElementById("expiredate").disabled=!1,document.getElementById("expiredate").valueAsDate=new Date(1e3*e.exp)):(document.getElementById("never").checked=!0,document.getElementById("expiredate").disabled=!0,document.getElementById("expiredate").value=""),document.getElementById("download").checked=e.down),l.appendChild(t)}),l.selectedIndex=0,l.options[0].disabled=!0,l.addEventListener("change",function(e){if(document.getElementById("sname").value=e.target.selectedOptions[0].text,document.getElementById("sid").value=parseInt(e.target.selectedOptions[0].value)?e.target.selectedOptions[0].value:"",document.getElementById("link").value="",document.getElementById("rsh").disabled=!parseInt(e.target.selectedOptions[0].value),null==e.target.selectedOptions[0].dataset.dn||e.target.selectedOptions[0].dataset.dn?document.getElementById("download").checked=!0:document.getElementById("download").checked=!1,null==e.target.selectedOptions[0].dataset.ep||e.target.selectedOptions[0].dataset.ep){document.getElementById("never").checked=!1,document.getElementById("expiredate").disabled=!1;let t=new Date;document.getElementById("expiredate").valueAsDate=null==e.target.selectedOptions[0].dataset.ep?new Date(t.setDate(t.getDate()+rcmail.env.sdays)):new Date(1e3*e.target.selectedOptions[0].dataset.ep)}else document.getElementById("never").checked=!0,document.getElementById("expiredate").value="",document.getElementById("expiredate").disabled=!0}),document.getElementById("share_target").firstChild.replaceWith(l)}function albMove(e){if(document.getElementById("album_edit").style.display="none",200===e.code){document.getElementById("picturescontentframe").contentWindow.location.href="plugins/pictures/photos.php?p="+encodeURIComponent(e.target),sendRequest(getSubs),count_checks();let t=rcmail.gettext("alb_move_ok","pictures").replace("%s%",e.source);t=t.replace("%t%",e.target),rcmail.display_message(t,"confirmation")}else if(!0!==e.image){let t=rcmail.gettext("alb_move_image","pictures").replace("%s%",e.source);t=t.replace("%t%",e.target),rcmail.display_message(t,"error")}else if(!0!==e.thumbnail){let t=rcmail.gettext("alb_move_thumb","pictures").replace("%s%",e.target);t=t.replace("%t%",e.target),rcmail.display_message(t,"error")}}function albRename(e){if(document.getElementById("album_edit").style.display="none",200===e.code){document.getElementById("picturescontentframe").contentWindow.location.href="plugins/pictures/photos.php?p="+encodeURIComponent(e.old),sendRequest(getSubs);let t=rcmail.gettext("alb_ren_ok","pictures").replace("%s%",e.old);t=t.replace("%t%",e.new),rcmail.display_message(t,"confirmation")}else{let t=rcmail.gettext("alb_ren_fail","pictures").replace("%s%",e.old);t=t.replace("%t%",e.new),rcmail.display_message(t,"error")}}function rename_album(){sendRequest(albRename,{target:document.getElementById("album_name").value,source:document.getElementById("album_org").value})}function move_album(){sendRequest(albMove,{target:document.getElementById("target").value,source:document.getElementById("album_org").value})}function delete_album(){document.getElementById("album_org").value;if(confirm(rcmail.gettext("galdconfirm","pictures"))){let e=document.getElementById("dalb");dloader("#album_edit",e,"add"),sendRequest(albDel,{source:document.getElementById("album_org").value})}}function albDel(e){if(dloader("#album_edit",dalb,"remove"),document.getElementById("album_edit").style.display="none",200===e.code){document.getElementById("picturescontentframe").contentWindow.location.href="plugins/pictures/photos.php",sendRequest(getSubs),count_checks();let t=rcmail.gettext("alb_del_ok","pictures").replace("%s%",e.path);t=t.replace("%t%",e.new),rcmail.display_message(t,"confirmation")}else{let t=rcmail.gettext("alb_del_fail","pictures").replace("%s%",e.path);t=t.replace("%t%",e.new),rcmail.display_message(t,"error")}}function sharepicture(){let e="";if(document.getElementById("intern").checked&&(e="intern"),document.getElementById("public").checked&&(e="public"),document.getElementById("pixelfed").checked&&(e="pixelfed"),"pixelfed"===e&&""==document.getElementById("pstatus").value)return document.getElementById("pstatus").style.borderColor="red",rcmail.display_message(rcmail.gettext("empty_status","pictures"),"error"),!1;var t=[];dloader("#share_edit",sbtn,"add");let n=document.getElementById("link");n.style.display="none",$("#picturescontentframe").contents().find(":checkbox:checked").each(function(){const e=new URL($(this)[0].previousElementSibling.firstChild.src).searchParams;t.push(e.get("file"))}),sendRequest(share,{images:t,shareid:document.getElementById("sid").value,sharename:document.getElementById("sname").value,download:document.getElementById("download").value,expiredate:Math.floor(document.getElementById("expiredate").valueAsNumber/1e3),suser:document.getElementById("suser").value,uid:document.getElementById("uid").value,type:e,pf_text:document.getElementById("pstatus").value,pf_sens:document.getElementById("pfsensitive").checked,pf_vis:document.getElementById("pfvisibility").value})}function share(e){let t=document.getElementById("sbtn"),n=document.getElementById("btnclp"),l=document.getElementById("link");if("intern"===e.type&&(document.getElementById("expiredate").disabled=!1,document.getElementById("expiredate").style.color="black",document.getElementById("never").disabled=!1,document.getElementById("share_edit").style.display="none"),"pixelfed"===e.type&&(e.pixelfed.uri&&console.log("Shared to Pixelfed",e.pixelfed.uri),document.getElementById("share_edit").style.display="none"),"public"===e.type){const d=new URL(location.href);let i=d.protocol+"//"+d.hostname+d.pathname+"?_task=pictures&slink="+e.link;$("#link").contents().get(0).nodeValue=i,n.addEventListener("click",e=>(e.preventDefault(),copyPageUrl(i),document.getElementById("share_edit").style.display="none",!1)),n.style.display="block",l.style.visibility="visible",l.style.display="block",t.style.display="none",dloader("#share_edit",t,"remove")}dloader("#share_edit",t,"remove"),count_checks()}async function copyPageUrl(e){try{await navigator.clipboard.writeText(e)}catch(e){console.error("Failed to copy: ",e)}}function dloader(e,t,n){document.getElementById("mdark")&&document.getElementById("mdark").remove();let l=document.querySelector(e+" .modal-content"),d=document.createElement("div");d.id="mdark","add"==n?(l.appendChild(d),t.classList.add("loading")):t.classList.remove("loading")}function copyLink(){let e=document.getElementById("link").innerText;return navigator.clipboard.writeText(e),document.getElementById("share_edit").style.display="none",!1}function move_picture(){let e=document.getElementById("mvp");dloader("#img_edit",e,"add");var t=[];$("#picturescontentframe").contents().find(":checkbox:checked").each(function(){t.push($(this).val())}),sendRequest(imgMove,{images:t,source:document.getElementById("album_org_img").value,target:document.getElementById("target").selectedOptions[0].value,nepath:document.getElementById("album_name_img").value})}function imgMove(e){200===e.code&&(document.getElementById("img_edit").style.display="none",document.getElementById("picturescontentframe").contentWindow.location.reload(!0),count_checks(),dloader("#img_edit",document.getElementById("mvp"),"remove"))}function mv_img(){var e=window.frames.picturescontentframe.location.search.slice(1),t="";if(e){for(e=e.split("#")[0],e=e.split("&"),t=0;t<e.length;t++){var n=e[t].split("=");if("p"==n[0])break}t=n[1]}t=decodeURI(t),$("#img_edit").contents().find("h2").html(rcmail.gettext("move_image","pictures")),$("#album_name_img").attr("placeholder",rcmail.gettext("new_album","pictures"));let l=document.getElementById("mvp");l.classList.remove("disabled"),document.getElementById("album_name_img").addEventListener("input",function(){let e=document.getElementById("album_name_img").value;e=e.length>0?e+"/":e,l.title=rcmail.gettext("move","pictures")+" "+rcmail.gettext("to","pictures")+": '"+document.getElementById("target").selectedOptions[0].value+"/"+e+"'"}),sendRequest(getSubs),document.getElementById("target")&&(document.getElementById("target").selectedIndex=0),document.getElementById("album_name_img").value="",document.getElementById("img_edit").style.display="block",count_checks()}function delete_picture(){var e=[],t=window.frames.picturescontentframe.location.search.slice(1),n="";if(t){for(t=t.split("#")[0],t=t.split("&"),n=0;n<t.length;n++){var l=t[n].split("=");if("p"==l[0])break}n=l[1]}if(n=decodeURI(n),$("#picturescontentframe").contents().find(":checkbox:checked").each(function(){e.push($(this).val())}),!confirm(rcmail.gettext("picdconfirm","pictures").replace("%c",e.length)))return!1;sendRequest(imgDel,{images:e,source:n}),count_checks()}function imgDel(e){200===e.code&&(document.getElementById("picturescontentframe").contentWindow.location.reload(!0),count_checks())}var lightbox,tagify,clicks;window.rcmail&&rcmail.addEventListener("init",function(e){rcmail.register_command("rename_alb",rename_album,!0),rcmail.register_command("move_alb",move_album,!0),rcmail.register_command("sharepicture",selectShare,!0),rcmail.register_command("uploadpicture",uploadpicture,!0),rcmail.register_command("sharepic",sharepicture,!0),rcmail.register_command("delete_alb",delete_album,!0),rcmail.register_command("addalbum",add_album,!0),rcmail.register_command("add_alb",create_album,!0),rcmail.register_command("movepicture",mv_img,!0),rcmail.register_command("move_image",move_picture,!0),rcmail.register_command("delpicture",delete_picture,!0),rcmail.register_command("searchphoto",searchform,!0),rcmail.register_command("edit_meta",metaform,!0)}),window.onload=function(){if($("#images").length){$("#images").justifiedGallery({rowHeight:220,margins:7,border:0,lastRow:"nojustify",captions:!1,randomize:!1,selector:".glightbox"}),$("#images").justifiedGallery().on("jg.complete",function(e){e.currentTarget.clientHeight>100&&e.currentTarget.clientHeight<document.documentElement.clientWidth&&lazyload()});let l=new IntersectionObserver(function(e){let t=!document.getElementById("last");e[0].isIntersecting&&e[0].time>700&&t&&lazyload(!0)},{threshold:[0]});l.observe(document.querySelector("#btm")),lightbox=GLightbox({plyr:{config:{iconUrl:"plugins/pictures/js/plyr/plyr.svg",muted:!0}},autoplayVideos:!1,loop:!1,videosWidth:"100%",closeOnOutsideClick:!1}),lightbox.on("close",()=>{document.getElementById("infbtn")&&document.getElementById("infbtn").remove(),document.querySelectorAll(".exinfo").forEach(e=>{e.classList.remove("eshow")})}),lightbox.on("slide_changed",e=>{document.getElementById("infbtn")&&document.getElementById("infbtn").remove(),document.getElementById("fbtn")&&document.getElementById("fbtn").remove();let t=new URL(e.current.slideConfig.href),n="exif_"+t.searchParams.get("p"),l=document.querySelector(".gclose");if(document.getElementById(n)){let e=document.createElement("button");e.id="infbtn",e.dataset.iid=n,e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" version="1.0" viewBox="0 0 160 160"><g fill="white"><path d="M80 15c-35.88 0-65 29.12-65 65s29.12 65 65 65 65-29.12 65-65-29.12-65-65-65zm0 10c30.36 0 55 24.64 55 55s-24.64 55-55 55-55-24.64-55-55 24.64-55 55-55z"/><path d="M89.998 51.25a11.25 11.25 0 1 1-22.5 0 11.25 11.25 0 1 1 22.5 0zm.667 59.71c-.069 2.73 1.211 3.5 4.327 3.82l5.008.1V120H60.927v-5.12l5.503-.1c3.291-.1 4.082-1.38 4.327-3.82V80.147c.035-4.879-6.296-4.113-10.757-3.968v-5.074L90.665 70"/></g></svg>',e.addEventListener("click",iBoxShow,!0),l.before(e)}document.getElementById("dlbtn")&&document.getElementById("dlbtn").remove();let d=document.createElement("button");d.id="dlbtn",d.classList.add("ex"),d.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" width="23" height="23" fill="#fff" stroke="#fff" viewBox="0 0 29.978 29.978"><path d="M25.462 19.105v6.848H4.515v-6.848H.489v8.861c0 1.111.9 2.012 2.016 2.012h24.967c1.115 0 2.016-.9 2.016-2.012v-8.861h-4.026zm-10.842-.679-5.764-6.965s-.877-.828.074-.828h3.248V.494S12.049 0 12.793 0h4.572c.536 0 .524.416.524.416v10.008h2.998c1.154 0 .285.867.285.867s-4.904 6.51-5.588 7.193c-.492.495-.964-.058-.964-.058z"/></svg>',d.addEventListener("click",t=>{window.location="plugins/pictures/simg.php?w=4&i="+new URL(e.current.slideConfig.href).searchParams.get("p")}),document.getElementById("images").classList.contains("dl")&&l.before(d),document.getElementById("infobox")&&iBoxShow()}),lightbox.on("slide_before_change",e=>{let t=e.current.index+1,n=document.getElementsByClassName("glightbox").length,l=!document.getElementById("last");t==n&&l&&setTimeout(lazyload,100,!0)});var e=window.scrollY,t=document.getElementById("header");function n(e,t){const n=document.getElementsByClassName("spl-pane");e>n.length&&lazyload(!0)}window.onscroll=function(){var n=window.scrollY;e>n?(t.style.top="0",n>150?t.classList.add("shadow"):t.classList.remove("shadow")):(t.style.top="-55px",t.classList.remove("shadow")),e=n},Spotlight.init(),Spotlight.addControl("info",function(e){const t=document.querySelector(".spl-footer");t.classList.toggle("show")}),Spotlight.addControl("idownload",function(e){const t=document.getElementsByClassName("spl-pane");for(let e=0;e<t.length;e++){const n=t[e];if(1===n.childElementCount)return window.location="simg.php?w=3&file="+new URL(n.firstChild.src).searchParams.get("file").replace(/([^:])(\/\/+)/g,"$1/"),!1}}),Spotlight.show([],{onchange:n})}if(top.location!=self.location&&(top.location=self.location.href),window.addEventListener("contextmenu",function(e){return e.preventDefault(),e.stopPropagation(),!1}),document.getElementById("never")&&document.getElementById("never").addEventListener("change",function(){if(1!=this.checked){document.getElementById("expiredate").disabled=!1;let e=new Date;document.getElementById("expiredate").valueAsDate=new Date(e.setDate(e.getDate()+rcmail.env.sdays))}else document.getElementById("expiredate").disabled=!0,document.getElementById("expiredate").value=""}),document.getElementById("rsh")&&document.getElementById("rsh").addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),sendRequest(shareDel,{share:document.getElementById("shares").selectedOptions[0].value})}),document.getElementById("skeywords")&&document.getElementById("skeywords").addEventListener("input",function(e){document.getElementById("skeywords").value.length>0&&document.getElementById("spb").classList.remove("disabled")}),document.getElementById("spb")&&document.getElementById("spb").addEventListener("click",function(){dosearch()}),document.getElementById("csb")&&document.getElementById("csb").addEventListener("click",function(e){document.getElementById("searchphotof").style.display="none"}),document.getElementById("mec")&&document.getElementById("mec").addEventListener("click",function(){document.getElementById("metadata").style.display="none"}),document.getElementById("searchphotof")){document.querySelector("#searchphotof form").addEventListener("submit",function(e){e.preventDefault(),dosearch()}),document.getElementById("metitle").addEventListener("input",function(e){document.getElementById("metitle").value.length>0&&document.getElementById("mes").classList.remove("disabled")}),document.getElementById("medescription").addEventListener("input",function(e){document.getElementById("medescription").value.length>0&&document.getElementById("mes").classList.remove("disabled")});const e=null!=rcmail.env.ptags?JSON.parse(rcmail.env.ptags):[];tagify=new Tagify(document.getElementById("mekeywords"),{whitelist:e,dropdown:{classname:"color-blue",trim:!0,enabled:0,maxItems:e.length,position:"text",closeOnSelect:!1,highlightFirst:!0},trim:!0,duplicates:!1,enforceWhitelist:!1,delimiters:",|;"}),tagify.on("add remove",function(e){document.getElementById("mes").classList.remove("disabled")}),document.getElementById("mes")&&document.getElementById("mes").addEventListener("click",function(){save_meta(e)})}document.getElementById("suser")&&document.getElementById("suser").addEventListener("change",function(e){sendRequest(validateUser,{user:this.value})});for(let e of document.querySelectorAll('input[type="radio"][name="stab"]'))e.addEventListener("input",e=>{"public"==e.target.id&&(document.getElementById("spublic").style.visibility="visible",
document.getElementById("sintern").style.visibility="hidden",document.getElementById("spixelfed").style.visibility="hidden",document.getElementById("sbtn").classList.remove("disabled")),"intern"==e.target.id&&(document.getElementById("spublic").style.visibility="hidden",document.getElementById("sintern").style.visibility="visible",document.getElementById("spixelfed").style.visibility="hidden",document.getElementById("sname").focus(),document.getElementById("sbtn").classList.remove("disabled")),"pixelfed"==e.target.id&&(document.getElementById("spublic").style.visibility="hidden",document.getElementById("sintern").style.visibility="hidden",document.getElementById("spixelfed").style.visibility="visible",document.getElementById("pstatus").focus(),sendRequest(pixelfed_verify),document.getElementById("picturescontentframe").contentWindow.document.querySelectorAll('input[type="checkbox"]:checked').length>1&&rcmail.display_message(rcmail.gettext("pftomuch","pictures"),"warning"))})};